<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esc√°ner de Jugos - Informaci√≥n Nutricional</title>
    <style>
        *:root {
    --verde: #003fa3;        /* Azul vibrante y fresco */
    --rosa: #FFCE32;         /* Amarillo suave/durazno */
    --rosa-oscuro: #fbdd7b;  /* Coral suave */
    --beige: #F7F6F2;        /* Beige claro y limpio */
    --marron: #6D4C41;       /* Marr√≥n chocolate elegante */
    --negro: #232946;        /* Azul oscuro profundo */
    --blanco: #ffffff;       /* Blanco puro */
}

    header {
  background: var(--verde);
  color: var(--blanco);
  padding:  20px;
  margin-bottom: 20px; /* Espacio despu√©s del header */
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

    header div:first-child {
      font-size: 28px;
      font-weight: bold;
      letter-spacing: 2px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
        
        {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background:  var(--beige);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: var(--rosa-oscuro);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .search-section {
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group input {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 25px;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            border-color:  var(--rosa);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-decoration: none;
            display: inline-block;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-volver {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .btn-escanear {
            background: linear-gradient(45deg, #007bff, #6f42c1);
        }

        .resultado-container {
            padding: 30px;
            display: none;
        }

        .producto-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
        }

        .producto-titulo {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .producto-marca {
            font-size: 1.2em;
            color: #666;
        }

        .nutricional-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .nutricional-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border-left: 4px solid  var(--rosa);
            transition: all 0.3s ease;
        }

        .nutricional-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .nutricional-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .valor-grande {
            font-size: 1.8em;
            font-weight: bold;
            color: #252088;
        }

        .cucharadas {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid #ffc107;
        }

        .cucharadas h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .recomendacion {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }

        .recomendacion.buena {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #28a745;
        }

        .recomendacion.moderada {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border: 2px solid #ffc107;
        }

        .recomendacion.alta {
            background: linear-gradient(135deg, #f8d7da, #f1b0b7);
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .dato-oms {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .ingredientes {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .ingredientes h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .botones {
            text-align: center;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #dc3545;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .nutricional-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
        #resultadoComparador > div[style*="display:flex"] {
    gap: 40px !important;
    margin-bottom: 30px;
}
@media (max-width: 900px) {
    #resultadoComparador > div[style*="display:flex"] {
        flex-direction: column !important;
        gap: 20px !important;
    }
}
    </style>
</head>
<header>
    <div>Scan & Sip</div>

  </header>
<body>
    <div class="container">
        <div class="header">
            <h1>ü•§ Esc√°ner de Jugos</h1>
            <p>Conoce la informaci√≥n nutricional de tu jugo favorito</p>
        </div>

        <!-- ...existing code... -->
        <!-- Secci√≥n de b√∫squeda -->
        <div class="search-section" id="searchSection">
            <h2>Ingresa el c√≥digo del producto</h2>
            <div class="input-group">
                <input type="text" id="codigo" placeholder="Ej: 001, ABC123, etc." onkeypress="if(event.key==='Enter') buscarJugo()">
            </div>
            <button onclick="buscarJugo()" class="btn">ESCANE√Å AQU√ç</button>
            <button onclick="mostrarComparador()" class="btn btn-escanear">Comparador</button>
        </div> <!-- Cierre de search-section -->

        <!-- Bloques fuera de search-section -->
        <div id="comparadorSection" style="display:none; margin-top:30px;">
            <h2>Compar√° dos jugos</h2>
            <div class="input-group">
                <input type="text" id="codigo1" placeholder="C√≥digo del primer jugo">
            </div>
            <div class="input-group">
                <input type="text" id="codigo2" placeholder="C√≥digo del segundo jugo">
            </div>
            <button onclick="compararJugos()" class="btn btn-escanear">Comparar</button>
        </div>
        <div id="resultadoComparador" style="display:none; margin-top:30px;">
            <div style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center;">
                <div id="jugo1" style="flex:1 1 300px;"></div>
                <div id="jugo2" style="flex:1 1 300px;"></div>
            </div>
            <div class="botones">
                <button onclick="nuevoComparador()" class="btn btn-escanear">Comparar otros</button>
                <a href="index.html" class="btn btn-volver">Volver al inicio</a>
            </div>
        </div>

        <!-- Secci√≥n de resultados -->
        <div class="resultado-container" id="resultadoContainer">
            <div class="producto-header">
                <div class="producto-titulo" id="nombre">Cargando...</div>
                <div class="producto-marca" id="marca"></div>
            </div>

            <div class="nutricional-grid">
                <div class="nutricional-card">
                    <h3>üç¨ Az√∫car</h3>
                    <div class="valor-grande" id="azucar">-</div>
                </div>
                <div class="nutricional-card">
                    <h3>üî• Calor√≠as</h3>
                    <div class="valor-grande" id="calorias">-</div>
                </div>
                <div class="nutricional-card">
                    <h3>üìè Volumen</h3>
                    <div class="valor-grande" id="volumen">-</div>
                </div>
                <div class="nutricional-card">
                    <h3>ü•§ Tipo</h3>
                    <div class="valor-grande" id="tipo" style="font-size: 1.2em;">-</div>
                </div>
            </div>

            <div class="cucharadas">
                <h3>ü•Ñ Equivalencia en Az√∫car</h3>
                <div class="valor-grande" id="cucharadas">- cucharadas</div>
            </div>

            <div class="recomendacion" id="recomendacion">
                Evaluando producto...
            </div>

            <div class="dato-oms">
                <strong>üí° Dato importante:</strong> La OMS recomienda que no deber√≠an superar los 15g aprox (3 cucharaditas de az√∫car) 
            </div>

            <div class="ingredientes">
                <h3>üîç Ingredientes:</h3>
                <p id="ingredientes">-</p>
            </div>

            <div class="botones">
                <button onclick="escanearOtro()" class="btn btn-escanear">üîç Escanear otro producto</button>
                <a href="index.html" class="btn btn-volver"> Volver al inicio</a>
            </div>
        </div>
    </div>

    <script>
    // Funci√≥n para extraer el n√∫mero de una cadena (ej: "500ml" -> 500)
function extraerNumero(texto) {
    if (!texto) return null;
    const match = texto.toString().match(/(\d+(?:\.\d+)?)/);
    return match ? parseFloat(match[1]) : null;
}

// Funci√≥n para obtener volumen en ml
function obtenerVolumenEnMl(producto) {
    let volumen = null;
    let unidad = 'ml';
    
    // Buscar en quantity primero
    if (producto.quantity) {
        const cantidad = extraerNumero(producto.quantity);
        if (cantidad) {
            volumen = cantidad;
            // Detectar unidad
            if (producto.quantity.toLowerCase().includes('l') && !producto.quantity.toLowerCase().includes('ml')) {
                unidad = 'L';
                volumen = cantidad * 1000; // Convertir a ml
            }
        }
    }
    
    // Si no encontr√≥, buscar en serving_size
    if (!volumen && producto.serving_size) {
        const cantidad = extraerNumero(producto.serving_size);
        if (cantidad) {
            volumen = cantidad;
            if (producto.serving_size.toLowerCase().includes('l') && !producto.serving_size.toLowerCase().includes('ml')) {
                unidad = 'L';
                volumen = cantidad * 1000;
            }
        }
    }
    
    // Valor por defecto
    if (!volumen) {
        volumen = 100;
        unidad = 'ml';
    }
    
    return { volumen, unidad, original: volumen };
}

// Funci√≥n para calcular az√∫car total del envase
function calcularAzucarTotal(azucarPor100ml, volumenTotal) {
    const azucarNum = extraerNumero(azucarPor100ml);
    if (!azucarNum || !volumenTotal) return null;
    
    return (azucarNum * volumenTotal / 100).toFixed(1);
}

// Funci√≥n para calcular cucharadas por 100ml
function calcularCucharadasPor100ml(azucarTexto) {
    // Buscar el az√∫car por 100ml (segundo n√∫mero entre par√©ntesis)
    const match = azucarTexto.match(/\((\d+(?:\.\d+)?)g\/100ml\)/);
    if (!match) {
        // Si no hay formato con par√©ntesis, buscar solo n√∫mero
        const simpleMatch = azucarTexto.match(/(\d+(?:\.\d+)?)/);
        if (!simpleMatch) return "N/A";
        const gramos = parseFloat(simpleMatch[1]);
        return isNaN(gramos) ? "N/A" : (gramos / 5).toFixed(1);
    }
    
    const gramosPor100ml = parseFloat(match[1]);
    if (isNaN(gramosPor100ml)) return "N/A";
    
    // 1 cucharadita = 5g de az√∫car
    const cucharaditas = (gramosPor100ml / 5).toFixed(1);
    return cucharaditas;
}

// Funci√≥n para extraer az√∫car por 100ml del texto
function extraerAzucarPor100ml(azucarTexto) {
    // Buscar el az√∫car por 100ml (segundo n√∫mero entre par√©ntesis)
    const match = azucarTexto.match(/\((\d+(?:\.\d+)?)g\/100ml\)/);
    if (match) {
        return parseFloat(match[1]);
    }
    
    // Si no hay formato con par√©ntesis, buscar solo n√∫mero
    const simpleMatch = azucarTexto.match(/(\d+(?:\.\d+)?)/);
    if (simpleMatch) {
        return parseFloat(simpleMatch[1]);
    }
    
    return null;
}

// Funci√≥n para calcular cucharadas de az√∫car - ACTUALIZADA
function calcularCucharadas(azucarTexto) {
    // Buscar el primer n√∫mero (az√∫car total)
    const match = azucarTexto.match(/(\d+(?:\.\d+)?)/);
    if (!match) return "N/A";
    
    const gramos = parseFloat(match[1]);
    if (isNaN(gramos)) return "N/A";
    
    // 1 cucharadita = 5g de az√∫car
    const cucharaditas = (gramos / 5).toFixed(1);
    return cucharaditas;
}

// Funci√≥n para dar recomendaci√≥n nutricional general - ACTUALIZADA PARA 100ML
function darRecomendacion(azucarTexto) {
    // Extraer az√∫car por 100ml
    const gramosPor100ml = extraerAzucarPor100ml(azucarTexto);
    
    if (!gramosPor100ml && gramosPor100ml !== 0) {
        return {
            texto: "‚ö†Ô∏è No se pudo evaluar el contenido de az√∫car",
            clase: "moderada"
        };
    }
    
    const cucharaditasPor100ml = (gramosPor100ml / 5).toFixed(1);
    
    // Recomendaci√≥n basada en az√∫car por 100ml (medio vaso)
    if (gramosPor100ml <= 2.5) {
        return {
            texto: `‚úÖ EXCELENTE OPCI√ìN: Muy bajo en az√∫car (${cucharaditasPor100ml} cucharaditas por medio vaso de 100ml)`,
            clase: "buena"
        };
    } else if (gramosPor100ml <= 5) {
        return {
            texto: `‚úÖ BUENA OPCI√ìN: Bajo en az√∫car (${cucharaditasPor100ml} cucharaditas por medio vaso de 100ml)`,
            clase: "buena"
        };
    } else if (gramosPor100ml <= 10) {
        return {
            texto: `‚ö†Ô∏è CONSUMO MODERADO: ${cucharaditasPor100ml} cucharaditas por medio vaso de 100ml`,
            clase: "moderada"
        };
    } else if (gramosPor100ml <= 15) {
        return {
            texto: `‚ùå ALTO EN AZ√öCAR: ${cucharaditasPor100ml} cucharaditas por medio vaso - equivale al 67% del az√∫car diario recomendado`,
            clase: "alta"
        };
    } else {
        return {
            texto: `‚ùå MUY ALTO EN AZ√öCAR: ${cucharaditasPor100ml} cucharaditas por medio vaso - supera el az√∫car diario recomendado`,
            clase: "alta"
        };
    }
}

// Funci√≥n espec√≠fica para recomendaciones en ni√±os - ACTUALIZADA PARA 100ML
function darRecomendacionNinos(azucarTexto) {
    // Extraer az√∫car por 100ml
    const gramosPor100ml = extraerAzucarPor100ml(azucarTexto);
    
    if (!gramosPor100ml && gramosPor100ml !== 0) {
        return {
            texto: "‚ö†Ô∏è No se pudo evaluar el contenido de az√∫car",
            clase: "moderada"
        };
    }
    
    const cucharaditasPor100ml = (gramosPor100ml / 5).toFixed(1);
    
    // L√≠mite recomendado para ni√±os: 15g al d√≠a (3 cucharaditas)
    // Evaluamos qu√© porcentaje del l√≠mite diario representa 100ml
    const porcentajeLimite = ((gramosPor100ml / 15) * 100).toFixed(0);
    
    if (gramosPor100ml <= 2.5) {
        return {
            texto: `‚úÖ EXCELENTE PARA NI√ëOS: Solo ${cucharaditasPor100ml} cucharadita(s) por medio vaso (${porcentajeLimite}% del l√≠mite diario)`,
            clase: "buena",
            porcentajeLimite: porcentajeLimite
        };
    } else if (gramosPor100ml <= 5) {
        return {
            texto: `‚úÖ BUENO PARA NI√ëOS: ${cucharaditasPor100ml} cucharadita(s) por medio vaso (${porcentajeLimite}% del l√≠mite diario)`,
            clase: "buena",
            porcentajeLimite: porcentajeLimite
        };
    } else if (gramosPor100ml <= 10) {
        return {
            texto: `‚ö†Ô∏è MODERADO PARA NI√ëOS: ${cucharaditasPor100ml} cucharadita(s) por medio vaso (${porcentajeLimite}% del l√≠mite diario)`,
            clase: "moderada",
            porcentajeLimite: porcentajeLimite
        };
    } else {
        return {
            texto: `‚ùå ALTO PARA NI√ëOS: ${cucharaditasPor100ml} cucharadita(s) por medio vaso (${porcentajeLimite}% del l√≠mite diario)`,
            clase: "alta",
            porcentajeLimite: porcentajeLimite
        };
    }
}

// Funci√≥n para mostrar los resultados - ACTUALIZADA
function mostrarResultado(jugo) {
    document.getElementById('nombre').textContent = jugo.nombre;
    document.getElementById('marca').textContent = jugo.marca || '';
    document.getElementById('azucar').textContent = jugo.azucar;
    document.getElementById('calorias').textContent = jugo.calorias;
    document.getElementById('volumen').textContent = jugo.volumen || 'N/A';
    document.getElementById('tipo').textContent = jugo.tipo || 'Jugo';
    document.getElementById('ingredientes').textContent = jugo.ingredientes || 'No especificados';

    // Calcular cucharadas POR 100ML
    const cucharadas = calcularCucharadasPor100ml(jugo.azucar);
    document.getElementById('cucharadas').textContent = `${cucharadas} cucharadas por 100ml (medio vaso)`;

    // Mostrar recomendaci√≥n
    const recomendacion = darRecomendacion(jugo.azucar);
    const recomendacionEl = document.getElementById('recomendacion');
    recomendacionEl.textContent = recomendacion.texto;
    recomendacionEl.className = `recomendacion ${recomendacion.clase}`;

    // Mostrar secci√≥n de resultados y ocultar b√∫squeda
    document.getElementById('searchSection').style.display = 'none';
    document.getElementById('resultadoContainer').style.display = 'block';
}

// Funci√≥n para buscar jugo por c√≥digo - VERSI√ìN MEJORADA
async function buscarJugo() {
    const codigo = document.getElementById("codigo").value.trim();
    if (!codigo) {
        alert("Por favor, ingresa un c√≥digo.");
        return;
    }

    // Mostrar loading
    document.getElementById('nombre').textContent = 'Buscando producto...';
    document.getElementById('searchSection').style.display = 'none';
    document.getElementById('resultadoContainer').style.display = 'block';

    try {
        const res = await fetch(`https://world.openfoodfacts.org/api/v0/product/${codigo}.json`);

        if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
        }

        const data = await res.json();

        if (data.status === 1 && data.product) {
            const producto = data.product;
            
            // Obtener volumen del envase
            const volumenInfo = obtenerVolumenEnMl(producto);
            
            // Obtener az√∫car por 100ml
            const azucarPor100ml = producto.nutriments?.sugars_100g || 0;
            
            // Calcular az√∫car total del envase
            const azucarTotal = calcularAzucarTotal(azucarPor100ml, volumenInfo.volumen);
            
            // Mostrar volumen en formato legible
            let volumenTexto;
            if (volumenInfo.volumen >= 1000) {
                volumenTexto = `${(volumenInfo.volumen / 1000).toFixed(1)}L`;
            } else {
                volumenTexto = `${volumenInfo.volumen}ml`;
            }
            
            // Crear texto explicativo del az√∫car
            let azucarTexto;
            if (azucarTotal && azucarPor100ml > 0) {
                azucarTexto = `${azucarTotal}g total (${azucarPor100ml}g/100ml)`;
            } else if (azucarPor100ml > 0) {
                azucarTexto = `${azucarPor100ml}g/100ml`;
            } else {
                azucarTexto = 'No disponible';
            }
            
            // Adaptar los datos
            const jugo = {
                nombre: producto.product_name || 'Producto sin nombre',
                marca: producto.brands || '',
                azucar: azucarTexto,
                azucarTotal: azucarTotal || azucarPor100ml, // Para c√°lculos
                calorias: producto.nutriments?.['energy-kcal_100g'] ? `${producto.nutriments['energy-kcal_100g']} kcal/100ml` : 'No disponible',
                volumen: volumenTexto,
                tipo: producto.categories_tags?.includes('en:beverages') ? 'Bebida' : 'Producto',
                ingredientes: producto.ingredients_text || 'No especificados'
            };
            
            mostrarResultado(jugo);
            
            // Guardar en historial
            let historial = JSON.parse(localStorage.getItem('historialJugosInfo')) || [];
            if (historial.length === 0 || historial[historial.length-1].nombre !== jugo.nombre) {
                historial.push(jugo);
                localStorage.setItem('historialJugosInfo', JSON.stringify(historial));
            }
        } else {
            // Producto no encontrado
            document.getElementById('nombre').textContent = 'Producto no encontrado';
            document.getElementById('marca').textContent = `C√≥digo: ${codigo}`;
            document.getElementById('azucar').textContent = '-';
            document.getElementById('calorias').textContent = '-';
            document.getElementById('volumen').textContent = '-';
            document.getElementById('tipo').textContent = '-';
            document.getElementById('ingredientes').textContent = '-';
            document.getElementById('cucharadas').textContent = '- cucharadas por 100ml (medio vaso)';
            
            const recomendacionEl = document.getElementById('recomendacion');
            recomendacionEl.innerHTML = `
                <div class="error">
                    ‚ùå No se encontr√≥ ning√∫n producto con el c√≥digo "${codigo}".<br>
                    Verifica que el c√≥digo est√© correcto.
                </div>
            `;
            recomendacionEl.className = 'recomendacion';
        }
    } catch (error) {
        console.error("Error al buscar el producto:", error);
        document.getElementById('nombre').textContent = 'Error al cargar datos';
        document.getElementById('marca').textContent = '';
        document.getElementById('azucar').textContent = '-';
        document.getElementById('calorias').textContent = '-';
        document.getElementById('volumen').textContent = '-';
        document.getElementById('tipo').textContent = '-';
        document.getElementById('ingredientes').textContent = '-';
        document.getElementById('cucharadas').textContent = '- cucharadas por 100ml (medio vaso)';
        
        const recomendacionEl = document.getElementById('recomendacion');
        recomendacionEl.innerHTML = `
            <div class="error">
                ‚ùå Error al cargar los datos.<br>
                Verifica tu conexi√≥n o intenta nuevamente m√°s tarde.<br>
                Error: ${error.message}
            </div>
        `;
        recomendacionEl.className = 'recomendacion';
    }
}

// Funci√≥n para escanear otro producto
function escanearOtro() {
    // Limpiar el input
    document.getElementById('codigo').value = '';
    
    // Limpiar todos los campos de resultado
    document.getElementById('nombre').textContent = 'Cargando...';
    document.getElementById('marca').textContent = '';
    document.getElementById('azucar').textContent = '-';
    document.getElementById('calorias').textContent = '-';
    document.getElementById('volumen').textContent = '-';
    document.getElementById('tipo').textContent = '-';
    document.getElementById('ingredientes').textContent = '-';
    document.getElementById('cucharadas').textContent = '- cucharadas por 100ml (medio vaso)';
    
    // Limpiar recomendaci√≥n
    const recomendacionEl = document.getElementById('recomendacion');
    recomendacionEl.textContent = 'Evaluando producto...';
    recomendacionEl.className = 'recomendacion';
    
    // Mostrar secci√≥n de b√∫squeda y ocultar resultados
    document.getElementById('searchSection').style.display = 'block';
    document.getElementById('resultadoContainer').style.display = 'none';
    
    // Enfocar el input para facilitar la siguiente b√∫squeda
    document.getElementById('codigo').focus();
}

function mostrarComparador() {
    document.getElementById('searchSection').style.display = 'none';
    document.getElementById('resultadoContainer').style.display = 'none';
    document.getElementById('comparadorSection').style.display = 'block';
    document.getElementById('resultadoComparador').style.display = 'none';
}

async function compararJugos() {
    const codigo1 = document.getElementById('codigo1').value.trim();
    const codigo2 = document.getElementById('codigo2').value.trim();
    if (!codigo1 || !codigo2) {
        alert("Por favor, ingresa ambos c√≥digos.");
        return;
    }
    document.getElementById('comparadorSection').style.display = 'none';
    document.getElementById('resultadoComparador').style.display = 'block';
    document.getElementById('jugo1').innerHTML = '<div class="loading">Buscando primer jugo...</div>';
    document.getElementById('jugo2').innerHTML = '<div class="loading">Buscando segundo jugo...</div>';

    const jugo1 = await obtenerJugo(codigo1);
    const jugo2 = await obtenerJugo(codigo2);

    document.getElementById('jugo1').innerHTML = renderJugoComparador(jugo1, 1);
    document.getElementById('jugo2').innerHTML = renderJugoComparador(jugo2, 2);

    // Guardar ambos jugos completos en historialJugosInfo
    let historial = JSON.parse(localStorage.getItem('historialJugosInfo')) || [];
    if (jugo1.nombre && jugo1.nombre !== 'Producto no encontrado' && (historial.length === 0 || historial[historial.length-1].nombre !== jugo1.nombre)) {
        historial.push(jugo1);
    }
    if (jugo2.nombre && jugo2.nombre !== 'Producto no encontrado' && (historial.length === 0 || historial[historial.length-1].nombre !== jugo2.nombre)) {
        historial.push(jugo2);
    }
    localStorage.setItem('historialJugosInfo', JSON.stringify(historial));
}

// Funci√≥n para obtener jugo - MEJORADA PARA COMPARADOR
async function obtenerJugo(codigo) {
    try {
        const res = await fetch(`https://world.openfoodfacts.org/api/v0/product/${codigo}.json`);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const data = await res.json();
        if (data.status === 1 && data.product) {
            const producto = data.product;
            
            // Obtener volumen del envase
            const volumenInfo = obtenerVolumenEnMl(producto);
            
            // Obtener az√∫car por 100ml
            const azucarPor100ml = producto.nutriments?.sugars_100g || 0;
            
            // Calcular az√∫car total del envase
            const azucarTotal = calcularAzucarTotal(azucarPor100ml, volumenInfo.volumen);
            
            // Mostrar volumen en formato legible
            let volumenTexto;
            if (volumenInfo.volumen >= 1000) {
                volumenTexto = `${(volumenInfo.volumen / 1000).toFixed(1)}L`;
            } else {
                volumenTexto = `${volumenInfo.volumen}ml`;
            }
            
            // Crear texto explicativo del az√∫car
            let azucarTexto;
            if (azucarTotal && azucarPor100ml > 0) {
                azucarTexto = `${azucarTotal}g total (${azucarPor100ml}g/100ml)`;
            } else if (azucarPor100ml > 0) {
                azucarTexto = `${azucarPor100ml}g/100ml`;
            } else {
                azucarTexto = 'No disponible';
            }
            
            return {
                nombre: producto.product_name || 'Producto sin nombre',
                marca: producto.brands || '',
                azucar: azucarTexto,
                calorias: producto.nutriments?.['energy-kcal_100g'] ? `${producto.nutriments['energy-kcal_100g']} kcal/100ml` : 'No disponible',
                volumen: volumenTexto,
                tipo: producto.categories_tags?.includes('en:beverages') ? 'Bebida' : 'Producto',
                ingredientes: producto.ingredients_text || 'No especificados'
            };
        } else {
            return { 
                nombre: 'Producto no encontrado', 
                marca: `C√≥digo: ${codigo}`, 
                azucar: '-', 
                calorias: '-', 
                volumen: '-', 
                tipo: '-', 
                ingredientes: '-' 
            };
        }
    } catch (error) {
        return { 
            nombre: 'Error al cargar datos', 
            marca: '', 
            azucar: '-', 
            calorias: '-', 
            volumen: '-', 
            tipo: '-', 
            ingredientes: '-' 
        };
    }
}

function renderJugoComparador(jugo, n) {
    const cucharadas = calcularCucharadasPor100ml(jugo.azucar);
    const recomendacion = darRecomendacion(jugo.azucar);
    return `
    <div class="producto-header">
        <div class="producto-titulo">${jugo.nombre}</div>
        <div class="producto-marca">${jugo.marca}</div>
    </div>
    <div class="nutricional-grid">
        <div class="nutricional-card">
            <h3>üç¨ Az√∫car</h3>
            <div class="valor-grande">${jugo.azucar}</div>
        </div>
        <div class="nutricional-card">
            <h3>üî• Calor√≠as</h3>
            <div class="valor-grande">${jugo.calorias}</div>
        </div>
        <div class="nutricional-card">
            <h3>üìè Volumen</h3>
            <div class="valor-grande">${jugo.volumen}</div>
        </div>
        <div class="nutricional-card">
            <h3>ü•§ Tipo</h3>
            <div class="valor-grande" style="font-size: 1.2em;">${jugo.tipo}</div>
        </div>
    </div>
    <div class="cucharadas">
        <h3>ü•Ñ Equivalencia en Az√∫car</h3>
        <div class="valor-grande">${cucharadas} cucharadas por 100ml (medio vaso)</div>
    </div>
    <div class="recomendacion ${recomendacion.clase}">
        ${recomendacion.texto}
    </div>
    <div class="ingredientes">
        <h3>üîç Ingredientes:</h3>
        <p>${jugo.ingredientes}</p>
    </div>
    `;
}

function nuevoComparador() {
    document.getElementById('codigo1').value = '';
    document.getElementById('codigo2').value = '';
    document.getElementById('comparadorSection').style.display = 'block';
    document.getElementById('resultadoComparador').style.display = 'none';
}
    </script>
</body>
</html>